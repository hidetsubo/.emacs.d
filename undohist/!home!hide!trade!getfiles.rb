
((digest . "5d4d1256cf4806e3509aa1d38869479f") (undo-list nil (451 . 453) nil (#("1" 0 1 (fontified t)) . -451) nil (#("0" 0 1 (fontified t)) . -452) (t 20721 . 25351) nil (477 . 479) nil (476 . 477) nil (475 . 476) nil (471 . 475) (t 20721 . 25243) nil (#("# >> \"getfile:2012-12-28\"
# >> \"getfile:2012-12-27\"
# >> \"getfile:2012-12-26\"
# >> \"getfile:2012-12-25\"
# >> \"getfile:2012-12-21\"
# >> \"getfile:2012-12-20\"
# >> \"getfile:2012-12-19\"
# >> \"getfile:2012-12-18\"
# >> \"getfile:2012-12-17\"
# >> \"getfile:2012-12-14\"
# >> \"getfile:2012-12-13\"
# >> \"getfile:2012-12-12\"
# >> \"getfile:2012-12-11\"
# >> \"getfile:2012-12-10\"
# >> \"getfile:2012-12-07\"
# >> \"getfile:2012-12-06\"
# >> \"getfile:2012-12-05\"
# >> \"getfile:2012-12-04\"
# >> \"getfile:2012-12-03\"" 0 2 (face font-lock-comment-delimiter-face fontified t) 2 24 (face font-lock-comment-face fontified t) 24 25 (face font-lock-comment-face syntax-table nil fontified t) 25 26 (face font-lock-comment-face fontified t) 26 28 (face font-lock-comment-delimiter-face fontified t) 28 50 (face font-lock-comment-face fontified t) 50 51 (face font-lock-comment-face syntax-table nil fontified t) 51 52 (face font-lock-comment-face fontified t) 52 54 (face font-lock-comment-delimiter-face fontified t) 54 76 (face font-lock-comment-face fontified t) 76 77 (face font-lock-comment-face syntax-table nil fontified t) 77 78 (face font-lock-comment-face fontified t) 78 80 (face font-lock-comment-delimiter-face fontified t) 80 102 (face font-lock-comment-face fontified t) 102 103 (face font-lock-comment-face syntax-table nil fontified t) 103 104 (face font-lock-comment-face fontified t) 104 106 (face font-lock-comment-delimiter-face fontified t) 106 128 (face font-lock-comment-face fontified t) 128 129 (face font-lock-comment-face syntax-table nil fontified t) 129 130 (face font-lock-comment-face fontified t) 130 132 (face font-lock-comment-delimiter-face fontified t) 132 154 (face font-lock-comment-face fontified t) 154 155 (face font-lock-comment-face syntax-table nil fontified t) 155 156 (face font-lock-comment-face fontified t) 156 158 (face font-lock-comment-delimiter-face fontified t) 158 180 (face font-lock-comment-face fontified t) 180 181 (face font-lock-comment-face syntax-table nil fontified t) 181 182 (face font-lock-comment-face fontified t) 182 184 (face font-lock-comment-delimiter-face fontified t) 184 206 (face font-lock-comment-face fontified t) 206 207 (face font-lock-comment-face syntax-table nil fontified t) 207 208 (face font-lock-comment-face fontified t) 208 210 (face font-lock-comment-delimiter-face fontified t) 210 232 (face font-lock-comment-face fontified t) 232 233 (face font-lock-comment-face syntax-table nil fontified t) 233 234 (face font-lock-comment-face fontified t) 234 236 (face font-lock-comment-delimiter-face fontified t) 236 258 (face font-lock-comment-face fontified t) 258 259 (face font-lock-comment-face syntax-table nil fontified t) 259 260 (face font-lock-comment-face fontified t) 260 262 (face font-lock-comment-delimiter-face fontified t) 262 284 (face font-lock-comment-face fontified t) 284 285 (face font-lock-comment-face syntax-table nil fontified t) 285 286 (face font-lock-comment-face fontified t) 286 288 (face font-lock-comment-delimiter-face fontified t) 288 310 (face font-lock-comment-face fontified t) 310 311 (face font-lock-comment-face syntax-table nil fontified t) 311 312 (face font-lock-comment-face fontified t) 312 314 (face font-lock-comment-delimiter-face fontified t) 314 336 (face font-lock-comment-face fontified t) 336 337 (face font-lock-comment-face syntax-table nil fontified t) 337 338 (face font-lock-comment-face fontified t) 338 340 (face font-lock-comment-delimiter-face fontified t) 340 362 (face font-lock-comment-face fontified t) 362 363 (face font-lock-comment-face syntax-table nil fontified t) 363 364 (face font-lock-comment-face fontified t) 364 366 (face font-lock-comment-delimiter-face fontified t) 366 388 (face font-lock-comment-face fontified t) 388 389 (face font-lock-comment-face syntax-table nil fontified t) 389 390 (face font-lock-comment-face fontified t) 390 392 (face font-lock-comment-delimiter-face fontified t) 392 414 (face font-lock-comment-face fontified t) 414 415 (face font-lock-comment-face syntax-table nil fontified t) 415 416 (face font-lock-comment-face fontified t) 416 418 (face font-lock-comment-delimiter-face fontified t) 418 440 (face font-lock-comment-face fontified t) 440 441 (face font-lock-comment-face syntax-table nil fontified t) 441 442 (face font-lock-comment-face fontified t) 442 444 (face font-lock-comment-delimiter-face fontified t) 444 466 (face font-lock-comment-face fontified t) 466 467 (face font-lock-comment-face syntax-table nil fontified t) 467 468 (face font-lock-comment-face fontified t) 468 470 (face font-lock-comment-delimiter-face fontified t) 470 492 (face font-lock-comment-face fontified t) 492 493 (face font-lock-comment-face syntax-table nil fontified t)) . 3350) (t 20721 . 25207) nil (#(" " 0 1 (fontified t)) . 453) nil (#(" " 0 1 (fontified t)) . 453) nil (451 . 453) nil (451 . 452) (#("2" 0 1 (fontified t)) . -451) nil (452 . 453) (#("5" 0 1 (fontified t)) . -452) (t 20721 . 25082) nil (735 . 736) nil (734 . 735) nil (216 . 217) nil (215 . 216) nil (#("
" 0 1 (fontified t)) . -262) nil (#(" " 0 1 (syntax-table nil fontified t)) . -263) nil (#(" " 0 1 (syntax-table nil fontified t)) . -264) nil (#(" " 0 1 (syntax-table nil fontified t)) . -265) nil (#(" " 0 1 (syntax-table nil fontified t)) . -266) nil (#("p" 0 1 (syntax-table nil fontified t)) . -267) nil (267 . 268) nil (263 . 267) (#(" " 0 1 (syntax-table nil fontified t)) . -263) 263 nil (262 . 263) nil (359 . 3840) (#("
    h = Holiday.new
    once = true

    while fs < 25 do #２５日移動平均を得るため

      while h.is_closed(d) == true do
        d = d - 1
      end
      g = true
      #p d.to_s
      files.each{  |f| 
        md = f.match(/(.*)([0-9]{4}\\-[0-9]{2}\\-[0-9]{2})(.*)/)
        if d.to_s == md[2].to_s
          g = false
        end
      }
      filename = d.strftime(\"%Y-%m-%d\") #+ \"-d_stock.csv\"
      url = \"http://k-db.com/site/download.aspx?date=\" +filename + \"&p=stockT&download=csv\"
      if g == true
        p \"getfile:#{d.to_s}\"
        GetFile.get_file(filename,url,once)
        csv_to_daydata(filename)
      end
      once = false
      fs = fs + 1
      d = d - 1
    end
  end
  
  def self.get_file(filename,url,once)
    begin
      timeout(10) {
        begin
          open(url) do |source|
            open(PATH+filename,\"w\") do |o|
              o.print source.read.toutf8
            end
          end
          #if once == true
            #open(\"http://ichart.finance.yahoo.com/table.csv?s=%5EN225&a=00&b=4&c=1984&d=11&e=31&f=2050&g=d&ignore=.csv\") do |source|
              #open(\"/home/hide/trade/nikkei.csv\",\"w\") do |o|
                #o.print source.read.toutf8
              #end
            #end
          #end
        rescue => exception
            puts exception.to_s + \"(#{exception.class})\"
        end
      }
    rescue TimeoutError
      # Timeout時の処理
      puts \"読み込みに時間がかかりすぎたため、処理を終了しました。\"
    end
  end  
  
  def csv_to_daydata(filename)
    i = 0
    f=open(PATH + filename)
    f.each { |ln|
      i = i + 1
    }
    f.close
    data = Array.new(i-1).map!{ Array.new }
    md = /([0-9]{4}),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),([0-9]*)/
    first = 0
    i = 0
    f = open(PATH + filename)
    f.each { |line|
      if first != 0
        line1=line.toutf8
        d=line1.match(md)
        if d != nil
          if data[i-1][0] == d[1].to_i
            if data[i-1][6] <= d[9].to_f/1000
              #p \"#{d[1]} id same: #{d[9]}\" 
              i = i - 1
            end
          end
          data[i][0]=d[1].to_i
#          data[i][1]=d[3]
          data[i][1]=d[2]
          data[i][2]=d[5].to_i
          data[i][3]=d[6].to_i
          data[i][4]=d[7].to_i
          data[i][5]=d[8].to_i
          data[i][6]=(d[9].to_f/1000)
          i=i+1
        end
      end
      first = 1
    }
    f.close
    f=open(PATH + filename,\"w\")
    f.puts filename[0..3]+filename[5..6]+filename[8..9]
    data.each_index { |i|
      k = false
      (0..6).each { |j|
        if data[i][j] != nil
          k = true
        end
      }
      if k == true
        (0..5).each{ |j|
          f.write data[i][j].to_s + \",\"
        }
        f.puts data[i][6].to_s 
      else
 #       p data[i][1] + \";\" + i.to_s + \";\" + j.to_s
      end
    } 
    f.close
  end
end

GetFile.new.set_date" 0 9 (fontified t) 9 16 (face font-lock-type-face fontified t) 16 19 (fontified t) 19 20 (syntax-table nil fontified t) 20 32 (fontified t) 32 35 (face font-lock-variable-name-face fontified t) 35 36 (face font-lock-variable-name-face syntax-table nil fontified t) 36 42 (fontified t) 42 47 (face font-lock-keyword-face fontified t) 47 56 (fontified t) 56 58 (face font-lock-keyword-face fontified t) 58 59 (fontified t) 59 60 (face font-lock-comment-delimiter-face fontified t) 60 71 (face font-lock-comment-face fontified t) 71 72 (face font-lock-comment-face syntax-table nil fontified t) 72 73 (face font-lock-comment-face fontified t) 73 80 (fontified t) 80 85 (face font-lock-keyword-face fontified t) 85 104 (fontified t) 104 108 (face font-lock-variable-name-face fontified t) 108 109 (fontified t) 109 110 (face font-lock-keyword-face fontified t) 110 111 (face font-lock-keyword-face syntax-table nil fontified t) 111 128 (fontified t) 128 129 (syntax-table nil fontified t) 129 136 (fontified t) 136 138 (face font-lock-keyword-face fontified t) 138 139 (face font-lock-keyword-face syntax-table nil fontified t) 139 150 (fontified t) 150 153 (face font-lock-variable-name-face fontified t) 153 154 (face font-lock-variable-name-face syntax-table nil fontified t) 154 155 (fontified t) 155 161 (fontified t) 161 162 (face font-lock-comment-delimiter-face fontified t) 162 169 (face font-lock-comment-face fontified t) 169 170 (face font-lock-comment-face syntax-table nil fontified t) 170 171 (face font-lock-comment-face fontified t) 171 193 (fontified t) 193 194 (syntax-table nil fontified t) 194 216 (fontified t) 216 217 (face font-lock-string-face syntax-table (7 . 47) fontified t) 217 255 (face font-lock-string-face fontified t) 255 256 (face font-lock-string-face syntax-table (7 . 47) fontified t) 256 257 (syntax-table nil fontified t) 257 266 (fontified t) 266 268 (face font-lock-keyword-face fontified t) 268 288 (fontified t) 288 289 (syntax-table nil fontified t) 289 304 (fontified t) 304 308 (face font-lock-variable-name-face fontified t) 308 309 (face font-lock-variable-name-face syntax-table nil fontified t) 309 318 (fontified t) 318 320 (face font-lock-keyword-face fontified t) 320 321 (face font-lock-keyword-face syntax-table nil fontified t) 321 328 (fontified t) 328 329 (syntax-table nil fontified t) 329 358 (fontified t) 358 368 (face font-lock-string-face fontified t) 368 370 (fontified t) 370 371 (face font-lock-comment-delimiter-face fontified t) 371 386 (face font-lock-comment-face fontified t) 386 387 (face font-lock-comment-face syntax-table nil fontified t) 387 388 (face font-lock-comment-face fontified t) 388 400 (fontified t) 400 406 (face font-lock-string-face fontified t) 406 407 (face font-lock-string-face syntax-table (7 . 47) fontified t) 407 408 (face font-lock-string-face syntax-table (7 . 47) fontified t) 408 442 (face font-lock-string-face fontified t) 442 455 (fontified t) 455 478 (face font-lock-string-face fontified t) 478 479 (face font-lock-string-face syntax-table nil fontified t) 479 480 (fontified t) 480 486 (fontified t) 486 488 (face font-lock-keyword-face fontified t) 488 494 (fontified t) 494 497 (face font-lock-variable-name-face fontified t) 497 498 (face font-lock-variable-name-face syntax-table nil fontified t) 498 509 (fontified t) 509 518 (face font-lock-string-face fontified t) 518 519 (face font-lock-variable-name-face syntax-table (1) fontified t) 519 527 (face font-lock-variable-name-face fontified t) 527 528 (face font-lock-string-face syntax-table nil fontified t) 528 537 (fontified t) 537 544 (face font-lock-type-face fontified t) 544 571 (fontified t) 571 572 (syntax-table nil fontified t) 572 604 (fontified t) 604 605 (syntax-table nil fontified t) 605 612 (fontified t) 612 614 (face font-lock-keyword-face fontified t) 614 615 (face font-lock-keyword-face syntax-table nil fontified t) 615 629 (fontified t) 629 633 (face font-lock-variable-name-face fontified t) 633 634 (face font-lock-variable-name-face syntax-table nil fontified t) 634 651 (fontified t) 651 652 (syntax-table nil fontified t) 652 667 (fontified t) 667 668 (syntax-table nil fontified t) 668 669 (fontified t) 669 673 (fontified t) 673 675 (face font-lock-keyword-face fontified t) 675 676 (face font-lock-keyword-face syntax-table nil fontified t) 676 679 (fontified t) 679 681 (face font-lock-keyword-face fontified t) 681 682 (face font-lock-keyword-face syntax-table nil fontified t) 682 684 (fontified t) 684 685 (syntax-table nil fontified t) 685 688 (fontified t) 688 691 (face font-lock-keyword-face fontified t) 691 692 (fontified t) 692 705 (face font-lock-function-name-face fontified t) 705 723 (fontified t) 723 724 (syntax-table nil fontified t) 724 729 (fontified t) 729 733 (face font-lock-keyword-face fontified t) 733 734 (face font-lock-keyword-face syntax-table nil fontified t) 734 753 (fontified t) 753 754 (syntax-table nil fontified t) 754 763 (fontified t) 763 767 (face font-lock-keyword-face fontified t) 767 768 (face font-lock-keyword-face syntax-table nil fontified t) 768 789 (fontified t) 789 791 (face font-lock-keyword-face fontified t) 791 799 (fontified t) 799 800 (syntax-table nil fontified t) 800 818 (fontified t) 818 822 (face font-lock-type-face fontified t) 822 832 (fontified t) 832 835 (face font-lock-string-face fontified t) 835 837 (fontified t) 837 839 (face font-lock-keyword-face fontified t) 839 842 (fontified t) 842 843 (syntax-table nil fontified t) 843 883 (fontified t) 883 884 (syntax-table nil fontified t) 884 897 (fontified t) 897 899 (face font-lock-keyword-face fontified t) 899 900 (face font-lock-keyword-face syntax-table nil fontified t) 900 911 (fontified t) 911 913 (face font-lock-keyword-face fontified t) 913 914 (face font-lock-keyword-face syntax-table nil fontified t) 914 925 (fontified t) 925 926 (face font-lock-comment-delimiter-face fontified t) 926 940 (face font-lock-comment-face fontified t) 940 941 (face font-lock-comment-face syntax-table nil fontified t) 941 942 (face font-lock-comment-face fontified t) 942 954 (fontified t) 954 955 (face font-lock-comment-delimiter-face fontified t) 955 966 (face font-lock-comment-face fontified t) 966 967 (face font-lock-comment-face syntax-table (7 . 47) fontified t) 967 968 (face font-lock-comment-face syntax-table (7 . 47) fontified t) 968 1074 (face font-lock-comment-face fontified t) 1074 1075 (face font-lock-comment-face syntax-table nil fontified t) 1075 1076 (face font-lock-comment-face fontified t) 1090 1091 (face font-lock-comment-delimiter-face) 1091 1136 (face font-lock-comment-face) 1136 1137 (face font-lock-comment-face syntax-table nil) 1137 1138 (face font-lock-comment-face) 1154 1155 (face font-lock-comment-delimiter-face) 1155 1180 (face font-lock-comment-face) 1180 1181 (face font-lock-comment-face syntax-table nil) 1181 1182 (face font-lock-comment-face)) . 359) (263 . 263) nil (262 . 263) (t 20582 . 21656)))
